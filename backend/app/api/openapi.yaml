openapi: 3.0.3
info:
  title: Sistema Academico API
  version: 0.1.0
  description: |
    API contract for the academic system, starting with admin user management.
    Expand with auth, courses, grades, and reports as endpoints are migrated from server-rendered views.
servers:
  - url: http://localhost:5000
    description: Local server
paths:
  /admin/users:
    get:
      summary: List users (admin)
      description: Returns the full list of users for admin dashboards.
      tags: [Admin]
      responses:
        '200':
          description: Users list
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/User'
                  count:
                    type: integer
                    description: Total number of users returned.
                required: [data, count]
              examples:
                demo:
                  summary: Sample payload
                  value:
                    data:
                      - id: 1
                        full_name: "Ana Perez"
                        email: "ana@example.com"
                        role: 2
                      - id: 2
                        full_name: "Luis Torres"
                        email: "luis@example.com"
                        role: 1
                    count: 2
        '401':
          description: Unauthorized; authentication required.
        '403':
          description: Forbidden; only admins can access this endpoint.
  /api/anuncios:
    get:
      summary: List announcements (public and private)
      description: |
        Returns public announcements for all users and private announcements when the
        caller has an active session. Private announcements are filtered by the current
        user stored in the session.
      tags: [Announcements]
      responses:
        '200':
          description: Announcements grouped by visibility.
          content:
            application/json:
              schema:
                type: object
                properties:
                  public_announcements:
                    type: array
                    description: Announcements visible to everyone.
                    items:
                      $ref: '#/components/schemas/Announcement'
                  private_announcements:
                    type: array
                    description: Announcements visible only to the authenticated user.
                    items:
                      $ref: '#/components/schemas/Announcement'
                  role:
                    type: integer
                    description: Role code from the current session (0 when unauthenticated).
                required: [public_announcements, private_announcements, role]
              examples:
                demo:
                  summary: Sample grouped announcements
                  value:
                    public_announcements:
                      - announcement_id: 10
                        title: "Bienvenida"
                        content: "Inicio del semestre."
                        is_private: false
                        course_id: null
                        user_id: 2
                        created_at: "2024-08-01T10:00:00Z"
                    private_announcements:
                      - announcement_id: 11
                        title: "Tarea 1"
                        content: "Entrega en una semana."
                        is_private: true
                        course_id: 3
                        user_id: 5
                        created_at: "2024-08-02T12:00:00Z"
                    role: 1
  /api/anuncios/admin:
    post:
      summary: Create announcement (admin)
      description: |
        Creates a public or private announcement. Only admins (role 2) with an active
        session can use this endpoint.
      tags: [Announcements]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AnnouncementCreateRequest'
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/AnnouncementCreateRequest'
      responses:
        '201':
          description: Announcement created.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AnnouncementCreateResponse'
        '400':
          description: Validation error while creating announcement.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorMessage'
        '403':
          description: Forbidden; only admins with an active session can create announcements.
  /parent_query_grades:
    get:
      summary: Get children grades (parent)
      description: |
        Returns the grades of all children for a parent user. Only authenticated users with
        parent role (role 3) can access this endpoint.
      tags: [Grades]
      responses:
        '200':
          description: Children grades retrieved successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ParentGradesResponse'
              examples:
                demo:
                  summary: Sample parent grades payload
                  value:
                    success: true
                    data:
                      - id: 5
                        name: "Juan Perez"
                        grades:
                          - course_name: "Matemáticas"
                            score: 8.5
                          - course_name: "Lenguaje"
                            score: 9.2
                      - id: 6
                        name: "María Perez"
                        grades:
                          - course_name: "Matemáticas"
                            score: 7.8
                          - course_name: "Ciencias"
                            score: 8.9
        '403':
          description: Forbidden; only parents with an active session can access this endpoint.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorMessage'
              examples:
                unauthorized:
                  summary: Unauthorized access
                  value:
                    success: false
                    message: "Acceso no autorizado."
  /admin/courses:
    get:
      summary: List all courses (admin)
      description: Returns the full list of courses for admin management.
      tags: [Courses]
      responses:
        '200':
          description: Courses list
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Course'
                  count:
                    type: integer
                required: [data, count]
              examples:
                demo:
                  summary: Sample courses list
                  value:
                    data:
                      - id: 1
                        name: "Matemáticas"
                        professor_id: 2
                      - id: 2
                        name: "Lenguaje"
                        professor_id: 3
                    count: 2
        '403':
          description: Forbidden; only admins can access this endpoint.
    post:
      summary: Create course (admin)
      description: Creates a new course and assigns a professor.
      tags: [Courses]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CourseCreateRequest'
      responses:
        '201':
          description: Course created successfully.
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
        '400':
          description: Validation error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorMessage'
        '403':
          description: Forbidden; only admins can create courses.
  /admin/professors:
    get:
      summary: List professors (admin)
      description: Returns all professors for course assignment.
      tags: [Courses]
      responses:
        '200':
          description: Professors list
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/User'
                required: [data]
              examples:
                demo:
                  summary: Sample professors list
                  value:
                    data:
                      - id: 2
                        full_name: "Luis Torres"
                        email: "luis@example.com"
                        role: 1
                      - id: 3
                        full_name: "María García"
                        email: "maria@example.com"
                        role: 1
        '403':
          description: Forbidden; only admins can access.
  /cursos:
    get:
      summary: Get professor courses
      description: Returns courses assigned to the authenticated professor.
      tags: [Courses]
      responses:
        '200':
          description: Professor courses list
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Course'
              examples:
                demo:
                  summary: Sample professor courses
                  value:
                    - id: 1
                      name: "Matemáticas"
                      professor_id: 2
                    - id: 3
                      name: "Física"
                      professor_id: 2
        '403':
          description: Forbidden; only professors can access.
components:
  schemas:
    Announcement:
      type: object
      properties:
        announcement_id:
          type: integer
        course_id:
          type: integer
          nullable: true
        user_id:
          type: integer
          description: Creator user id.
        title:
          type: string
        content:
          type: string
        is_private:
          type: boolean
        created_at:
          type: string
          format: date-time
      required: [announcement_id, user_id, title, content, is_private, created_at]
    AnnouncementCreateRequest:
      type: object
      properties:
        title:
          type: string
        content:
          type: string
        is_private:
          type: boolean
          default: false
        course_id:
          type: integer
          nullable: true
      required: [title, content]
    AnnouncementCreateResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        announcement:
          $ref: '#/components/schemas/Announcement'
      required: [success, message]
    ErrorMessage:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
      required: [success, message]
    User:
      type: object
      properties:
        id:
          type: integer
        full_name:
          type: string
        email:
          type: string
          format: email
        role:
          type: integer
          description: Role code (0=student, 1=professor, 2=admin, 3=parent, etc).
      required: [id, full_name, email, role]
    Grade:
      type: object
      properties:
        course_name:
          type: string
          description: Name of the course.
        score:
          type: number
          format: float
          description: Student grade/score for the course.
      required: [course_name, score]
    StudentWithGrades:
      type: object
      properties:
        id:
          type: integer
          description: Student user id.
        name:
          type: string
          description: Student full name.
        grades:
          type: array
          description: List of grades for the student.
          items:
            $ref: '#/components/schemas/Grade'
      required: [id, name, grades]
    ParentGradesResponse:
      type: object
      properties:
        success:
          type: boolean
          description: Indicates if the request was successful.
        data:
          type: array
          description: List of children with their grades.
          items:
            $ref: '#/components/schemas/StudentWithGrades'
        message:
          type: string
          description: Error message if success is false.
      required: [success]
    Course:
      type: object
      properties:
        id:
          type: integer
          description: Course identifier.
        name:
          type: string
          description: Course name.
        professor_id:
          type: integer
          description: ID of the assigned professor.
      required: [id, name, professor_id]
    CourseCreateRequest:
      type: object
      properties:
        name:
          type: string
          description: Course name.
        professor_id:
          type: integer
          description: ID of the professor to assign.
      required: [name, professor_id]
